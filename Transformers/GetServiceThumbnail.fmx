#! <?xml version="1.0" encoding="windows-1252" ?>
#! <TRANSFORMER
# TRANSFORMER_BEGIN GetServiceThumbnail,1,"Web Services",9d3d5932-bfc8-4693-b7dc-1aa93a93eb41,"Linked by Default",No,NO_PARALLELISM,,No,14338,YES,No
# <p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">It gets a web map service thumbnails (URL) or downloads it</p>
# 
# TRANSFORMER_END
#! PASSWORD=""
#! ATTR_TYPE_ENCODING="SDF"
#! VIEW_POSITION="-786 147"
#! SHOW_INFO_NODES="true"
#! FME_LINKED_TRANSFORMER_VERSION="1"
#! FMX_INSERT_MODE="Linked by Default"
#! BLOCKED_LOOPING="No"
#! DESCRIPTION="&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;It gets a web map service thumbnails (URL) or downloads it&lt;/p&gt;&#10;"
#! TITLE="GetServiceThumbnail"
#! MAX_LOOP_ITERATIONS=""
#! ITERATION_COUNT_ATTR=""
#! FME_BUILD_NUM="14338"
#! ZOOM_SCALE="100"
#! CATEGORY="Web Services"
#! LEGAL_TERMS_CONDITIONS="&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;&#10;    &lt;br/&gt;&#10;&lt;/p&gt;&#10;"
#! FME_PROCESS_GROUP_BY=""
#! USAGE="&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;Service url as input parameter&lt;/p&gt;&#10;"
#! HISTORY="12&lt;solidus&gt;09&lt;solidus&gt;2014,I&lt;u00f1&gt;aki&lt;space&gt;Diaz&lt;space&gt;de&lt;space&gt;Cerio,V.1.0"
#! FME_DOCUMENT_PRIORGUID="b5251b66-d7f5-484b-a483-d3dfb4a29dee,3185c6c6-f99e-4851-acf8-3f6eea979e61,66a6a975-9a62-4c16-ab14-03fc6a74a91f"
#! DOC_TOP_LEFT="-1910 -885"
#! XFORM_DEPRECATED="No"
#! REQUIREMENTS_KEYWORD="none"
#! LAST_SAVE_DATE="2014-09-16T13:56:37"
#! WORKSPACE_VERSION="1"
#! LAST_SAVE_BUILD="FME(R) 2014 SP2 (20140606 - Build 14338 - WIN64)"
#! FME_SERVER_SERVICES=""
#! REQUIREMENTS="&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;Service url as input parameter &lt;/p&gt;&#10;"
#! DOC_EXTENTS="3961 945"
#! FME_DOCUMENT_GUID="9d3d5932-bfc8-4693-b7dc-1aa93a93eb41"
#! FME_PROCESS_COUNT="NO_PARALLELISM"
#! SHOW_ANNOTATIONS="true"
#! FME_PROCESS_GROUPS_ORDERED="No"
#! WARN_INVALID_XFORM_PARAM="Yes"
#! >
#! <DATASETS>
#! </DATASETS>
#! <DATA_TYPES>
#! </DATA_TYPES>
#! <GEOM_TYPES>
#! </GEOM_TYPES>
#! <FEATURE_TYPES>
#! </FEATURE_TYPES>
#! <FMESERVER>
#! </FMESERVER>
#! <GLOBAL_PARAMETERS>
#! <GLOBAL_PARAMETER
#! GUI_LINE="GUI STRING_OR_ATTR_ENCODED _TESTSERVICEURL Testserviceurl:"
#! DEFAULT_VALUE="&lt;at&gt;Value&lt;openparen&gt;_testServiceUrl&lt;closeparen&gt;"
#! IS_STAND_ALONE="false"
#! />
#! <GLOBAL_PARAMETER
#! GUI_LINE="GUI OPTIONAL CHOICE_OR_ATTR DownloadImage Yes%No Download Image:"
#! DEFAULT_VALUE="No"
#! IS_STAND_ALONE="true"
#! />
#! </GLOBAL_PARAMETERS>
#! <COMMENTS>
#! <COMMENT
#! IDENTIFIER="20"
#! COMMENT_VALUE="&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0//EN&quot; &quot;http://www.w3.org/TR/REC-html40/strict.dtd&quot;&gt;&#10;&lt;html&gt;&lt;head&gt;&lt;meta name=&quot;qrichtext&quot; content=&quot;1&quot; /&gt;&lt;style type=&quot;text/css&quot;&gt;&#10;p, li { white-space: pre-wrap; }&#10;&lt;/style&gt;&lt;/head&gt;&lt;body style=&quot; font-family:&apos;MS Shell Dlg 2&apos;; font-size:11px; font-weight:400; font-style:normal;&quot;&gt;&#10;&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;It gets a web map service thumbnails (URL) or downloads it. Service url as input parameter &lt;/p&gt;&lt;/body&gt;&lt;/html&gt;"
#! POSITION="-1350 -252"
#! ORDER="5e+014"
#! FOLLOW_ANCHOR="true"
#! INFO_NODE="false"
#! TOP_LEFT="-1350 -252"
#! BOTTOM_RIGHT="-600 -302"
#! COLOUR="1,1,0.784314,0.192157"
#! SIZE_POLICY="10"
#! COMMENT_TYPE="REGULAR"
#! ANCHORED_NODE="0"
#! />
#! </COMMENTS>
#! <CONSTANTS>
#! </CONSTANTS>
#! <BOOKMARKS>
#! <BOOKMARK
#! IDENTIFIER="21"
#! NAME="Get service Thumbnail"
#! DESCRIPTION="&lt;html&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;"
#! TOP_LEFT="-1406 144"
#! BOTTOM_RIGHT="261 -204"
#! STICKY="true"
#! COLOUR="0.564706,0.494118,0.282353"
#! CONTENTS="17 18 3 7 1 "
#! />
#! <BOOKMARK
#! IDENTIFIER="22"
#! NAME="Download the Image"
#! DESCRIPTION="&lt;html&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;"
#! TOP_LEFT="315 150"
#! BOTTOM_RIGHT="1359 -237"
#! STICKY="true"
#! COLOUR="0.564706,0.592157,0.827451"
#! CONTENTS="14 4 6 "
#! />
#! <BOOKMARK
#! IDENTIFIER="23"
#! NAME="Remove attributes"
#! DESCRIPTION="&lt;html&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;"
#! TOP_LEFT="1400 -158"
#! BOTTOM_RIGHT="1954 -407"
#! STICKY="true"
#! COLOUR="0.847059,0.0784314,0.94902"
#! CONTENTS="5 "
#! />
#! </BOOKMARKS>
#! <TRANSFORMERS>
#! <TRANSFORMER
#! IDENTIFIER="1"
#! TYPE="HTTPFetcher"
#! VERSION="3"
#! POSITION="-1290 36"
#! ORDER="5e+014"
#! PARMS_EDITED="false"
#! ENABLED="true"
#! >
#! <OUTPUT_FEAT NAME="OUTPUT"/>
#! <FEAT_COLLAPSED COLLAPSED="0"/>
#! <XFORM_ATTR ATTR_NAME="_testServiceUrl" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.name" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.value" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_error" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_http_status_code" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="footPrint" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <OUTPUT_FEAT NAME="&lt;REJECTED&gt;"/>
#! <FEAT_COLLAPSED COLLAPSED="1"/>
#! <XFORM_ATTR ATTR_NAME="_testServiceUrl" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.name" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.value" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_error" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_http_status_code" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="footPrint" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_PARM PARM_NAME="HTTP_AUTH_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="TARGET_URL" PARM_VALUE="&lt;at&gt;Value&lt;openparen&gt;_testServiceUrl&lt;closeparen&gt;?f=json&lt;amp&gt;option=footprints"/>
#! <XFORM_PARM PARM_NAME="REQUEST_HEADER" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="PROXY_PASSWORD" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="PROXY_PORT" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="STATUS_CODE_ATTR" PARM_VALUE="_http_status_code"/>
#! <XFORM_PARM PARM_NAME="HTTP_REQUEST_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="TARGET_ATTR_ENCODING" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="AUTH_USERNAME" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="AUTH_PASSWORD" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="PROXY_USERNAME" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="SAVE_FILE" PARM_VALUE="No"/>
#! <XFORM_PARM PARM_NAME="PROXY_AUTH_METHOD" PARM_VALUE="Basic"/>
#! <XFORM_PARM PARM_NAME="PROXY_URL" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="XFORMER_NAME" PARM_VALUE="GetThumbnail"/>
#! <XFORM_PARM PARM_NAME="TRANSFORMER_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="FOLLOW_REDIRECTS" PARM_VALUE="Yes"/>
#! <XFORM_PARM PARM_NAME="OUTPUT_FILENAME" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="RESPONSE_HEADER_LIST_ATTR" PARM_VALUE="_headers"/>
#! <XFORM_PARM PARM_NAME="ERROR_ATTR" PARM_VALUE="_error"/>
#! <XFORM_PARM PARM_NAME="HTTP_RESPONSE_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="USE_COOKIES" PARM_VALUE="No"/>
#! <XFORM_PARM PARM_NAME="VERIFY_SSL_CERTIFICATES" PARM_VALUE="No"/>
#! <XFORM_PARM PARM_NAME="AUTH_METHOD" PARM_VALUE="Basic"/>
#! <XFORM_PARM PARM_NAME="TARGET_ATTR" PARM_VALUE="footPrint"/>
#! <XFORM_PARM PARM_NAME="PROXY_GROUP" PARM_VALUE=""/>
#! </TRANSFORMER>
#! <TRANSFORMER
#! IDENTIFIER="3"
#! TYPE="AttributeRenamer"
#! VERSION="2"
#! POSITION="-201 -19"
#! ORDER="5e+014"
#! PARMS_EDITED="true"
#! ENABLED="true"
#! >
#! <OUTPUT_FEAT NAME="OUTPUT"/>
#! <FEAT_COLLAPSED COLLAPSED="0"/>
#! <XFORM_ATTR ATTR_NAME="_testServiceUrl" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.name" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.value" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_error" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_http_status_code" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="footPrint" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="ThumbnailURL" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_PARM PARM_NAME="XFORMER_NAME" PARM_VALUE="ImageRenamer"/>
#! <XFORM_PARM PARM_NAME="ATTR_LIST" PARM_VALUE="featureCollection.layers{0}.featureSet.features{0}.attributes.thumbnail,ThumbnailURL,&quot;&quot;"/>
#! </TRANSFORMER>
#! <TRANSFORMER
#! IDENTIFIER="4"
#! TYPE="HTTPFetcher"
#! VERSION="3"
#! POSITION="884 -7"
#! ORDER="5e+014"
#! PARMS_EDITED="true"
#! ENABLED="true"
#! >
#! <OUTPUT_FEAT NAME="OUTPUT"/>
#! <FEAT_COLLAPSED COLLAPSED="0"/>
#! <XFORM_ATTR ATTR_NAME="_testServiceUrl" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.name" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.value" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_error" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_http_status_code" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="footPrint" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="ThumbnailURL" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="Thumbnaill" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <OUTPUT_FEAT NAME="&lt;REJECTED&gt;"/>
#! <FEAT_COLLAPSED COLLAPSED="1"/>
#! <XFORM_ATTR ATTR_NAME="_testServiceUrl" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.name" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.value" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_error" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_http_status_code" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="footPrint" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="ThumbnailURL" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="Thumbnaill" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_PARM PARM_NAME="HTTP_AUTH_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="TARGET_URL" PARM_VALUE="&lt;at&gt;Value&lt;openparen&gt;ThumbnailURL&lt;closeparen&gt;"/>
#! <XFORM_PARM PARM_NAME="REQUEST_HEADER" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="PROXY_PASSWORD" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="PROXY_PORT" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="STATUS_CODE_ATTR" PARM_VALUE="_http_status_code"/>
#! <XFORM_PARM PARM_NAME="HTTP_REQUEST_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="TARGET_ATTR_ENCODING" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="AUTH_USERNAME" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="AUTH_PASSWORD" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="PROXY_USERNAME" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="SAVE_FILE" PARM_VALUE="No"/>
#! <XFORM_PARM PARM_NAME="PROXY_AUTH_METHOD" PARM_VALUE="Basic"/>
#! <XFORM_PARM PARM_NAME="PROXY_URL" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="XFORMER_NAME" PARM_VALUE="HTTPFetcher"/>
#! <XFORM_PARM PARM_NAME="TRANSFORMER_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="FOLLOW_REDIRECTS" PARM_VALUE="Yes"/>
#! <XFORM_PARM PARM_NAME="OUTPUT_FILENAME" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="RESPONSE_HEADER_LIST_ATTR" PARM_VALUE="_headers"/>
#! <XFORM_PARM PARM_NAME="ERROR_ATTR" PARM_VALUE="_error"/>
#! <XFORM_PARM PARM_NAME="HTTP_RESPONSE_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="USE_COOKIES" PARM_VALUE="No"/>
#! <XFORM_PARM PARM_NAME="VERIFY_SSL_CERTIFICATES" PARM_VALUE="No"/>
#! <XFORM_PARM PARM_NAME="AUTH_METHOD" PARM_VALUE="Basic"/>
#! <XFORM_PARM PARM_NAME="TARGET_ATTR" PARM_VALUE="Thumbnaill"/>
#! <XFORM_PARM PARM_NAME="PROXY_GROUP" PARM_VALUE=""/>
#! </TRANSFORMER>
#! <TRANSFORMER
#! IDENTIFIER="5"
#! TYPE="AttributeRemover"
#! VERSION="0"
#! POSITION="1474 -248"
#! ORDER="5e+014"
#! PARMS_EDITED="true"
#! ENABLED="true"
#! >
#! <OUTPUT_FEAT NAME="OUTPUT"/>
#! <FEAT_COLLAPSED COLLAPSED="0"/>
#! <XFORM_ATTR ATTR_NAME="_testServiceUrl" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="ThumbnailURL" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="Thumbnaill" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_PARM PARM_NAME="LIST_ATTRS" PARM_VALUE="_headers&lt;opencurly&gt;&lt;closecurly&gt;.value _headers&lt;opencurly&gt;&lt;closecurly&gt;.name _headers&lt;opencurly&gt;&lt;closecurly&gt;"/>
#! <XFORM_PARM PARM_NAME="REMOVE_ATTRS" PARM_VALUE="_error,_http_status_code,footPrint,json_type,json_index,fme_type"/>
#! <XFORM_PARM PARM_NAME="XFORMER_NAME" PARM_VALUE="AttributeRemover"/>
#! <XFORM_PARM PARM_NAME="TRANSFORMER_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="PARAMETERS_GROUP" PARM_VALUE=""/>
#! </TRANSFORMER>
#! <TRANSFORMER
#! IDENTIFIER="6"
#! TYPE="Tester"
#! VERSION="2"
#! POSITION="355 60"
#! ORDER="5e+014"
#! PARMS_EDITED="true"
#! ENABLED="true"
#! >
#! <OUTPUT_FEAT NAME="PASSED"/>
#! <FEAT_COLLAPSED COLLAPSED="0"/>
#! <XFORM_ATTR ATTR_NAME="_testServiceUrl" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.name" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.value" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_error" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_http_status_code" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="footPrint" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="ThumbnailURL" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <OUTPUT_FEAT NAME="FAILED"/>
#! <FEAT_COLLAPSED COLLAPSED="1"/>
#! <XFORM_ATTR ATTR_NAME="_testServiceUrl" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.name" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.value" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_error" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_http_status_code" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="footPrint" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="ThumbnailURL" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_PARM PARM_NAME="TEST_MODE" PARM_VALUE="Automatic"/>
#! <XFORM_PARM PARM_NAME="TEST_DESCRIPTION" PARM_VALUE="&quot;&quot;"/>
#! <XFORM_PARM PARM_NAME="COMPOSITE_TEST" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="BOOL_OP" PARM_VALUE="OR"/>
#! <XFORM_PARM PARM_NAME="TEST_LIST" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="XFORMER_NAME" PARM_VALUE="Tester"/>
#! <XFORM_PARM PARM_NAME="TEST_CLAUSE" PARM_VALUE="TEST $(DownloadImage) = Yes"/>
#! </TRANSFORMER>
#! <TRANSFORMER
#! IDENTIFIER="7"
#! TYPE="JSONFlattener"
#! VERSION="2"
#! POSITION="-739 -9"
#! ORDER="5e+014"
#! PARMS_EDITED="true"
#! ENABLED="true"
#! >
#! <OUTPUT_FEAT NAME="OUTPUT"/>
#! <FEAT_COLLAPSED COLLAPSED="0"/>
#! <XFORM_ATTR ATTR_NAME="_testServiceUrl" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.name" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.value" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_error" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_http_status_code" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="footPrint" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="featureCollection.layers{0}.featureSet.features{0}.attributes.thumbnail" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_PARM PARM_NAME="PREFIX_STRING" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="XFORMER_NAME" PARM_VALUE="JSONFlattener"/>
#! <XFORM_PARM PARM_NAME="RECURSIVE" PARM_VALUE="Yes"/>
#! <XFORM_PARM PARM_NAME="TRANSFORMER_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="PARAMETERS_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="JSON_ATTR" PARM_VALUE="footPrint"/>
#! <XFORM_PARM PARM_NAME="NEW_ATTRIBUTES" PARM_VALUE="featureCollection.layers&lt;opencurly&gt;0&lt;closecurly&gt;.featureSet.features&lt;opencurly&gt;0&lt;closecurly&gt;.attributes.thumbnail"/>
#! </TRANSFORMER>
#! <TRANSFORMER
#! IDENTIFIER="24"
#! TYPE="ImageFetcher"
#! VERSION="2"
#! POSITION="892 -729"
#! ORDER="5e+014"
#! PARMS_EDITED="true"
#! ENABLED="true"
#! >
#! <OUTPUT_FEAT NAME="RASTER"/>
#! <FEAT_COLLAPSED COLLAPSED="0"/>
#! <XFORM_ATTR ATTR_NAME="_testServiceUrl" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.name" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.value" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_error" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_http_status_code" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="footPrint" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="ThumbnailURL" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="fme_basename" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <OUTPUT_FEAT NAME="&lt;REJECTED&gt;"/>
#! <FEAT_COLLAPSED COLLAPSED="1"/>
#! <XFORM_ATTR ATTR_NAME="_testServiceUrl" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.name" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.value" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_error" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_http_status_code" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="footPrint" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="ThumbnailURL" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="fme_basename" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_PARM PARM_NAME="HTTP_AUTH_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="RASTER_TYPE" PARM_VALUE="BMP"/>
#! <XFORM_PARM PARM_NAME="AUTH_PASSWORD" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="HTTP_PROXY_USERNAME" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="XFORMER_NAME" PARM_VALUE="ImageFetcher"/>
#! <XFORM_PARM PARM_NAME="HTTP_PROXY_PORT" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="HTTP_PROXY_PASSWORD" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="TRANSFORMER_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="AUTH_METHOD" PARM_VALUE="Basic"/>
#! <XFORM_PARM PARM_NAME="AUTH_USERNAME" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="HTTP_PROXY_URL" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="IMAGE_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="URL" PARM_VALUE="&lt;at&gt;Value&lt;openparen&gt;ThumbnailURL&lt;closeparen&gt;"/>
#! <XFORM_PARM PARM_NAME="PROXY_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="HTTP_PROXY_AUTH_METHOD" PARM_VALUE="Basic"/>
#! </TRANSFORMER>
#! <TRANSFORMER
#! IDENTIFIER="26"
#! TYPE="Inspector"
#! VERSION="3"
#! POSITION="1446 -747"
#! ORDER="5e+014"
#! PARMS_EDITED="false"
#! ENABLED="true"
#! >
#! <XFORM_PARM PARM_NAME="AREA_COLOR" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="THINNER_MAX_NUM_POINTS" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="TACKATTRS" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="VECTOR_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="POINTCLOUD_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="PEN_COLOR" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="XFORMER_NAME" PARM_VALUE="ImageFetcher_Raster"/>
#! <XFORM_PARM PARM_NAME="RASTER_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="THINNER_INTERVAL" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="RASTER_VISUALIZATION_OPTION" PARM_VALUE="No Reduction"/>
#! <XFORM_PARM PARM_NAME="TRANSFORMER_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="RASTER_NUM_ROWS" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="RASTER_START_COL" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="RASTER_NUM_COLS" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="THINNER_TYPE_DISPLAY" PARM_VALUE="No Thinning"/>
#! <XFORM_PARM PARM_NAME="RASTER_START_ROW" PARM_VALUE="&lt;Unused&gt;"/>
#! </TRANSFORMER>
#! <TRANSFORMER
#! IDENTIFIER="28"
#! TYPE="Inspector"
#! VERSION="3"
#! POSITION="1446 -885"
#! ORDER="5e+014"
#! PARMS_EDITED="false"
#! ENABLED="true"
#! >
#! <XFORM_PARM PARM_NAME="AREA_COLOR" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="THINNER_MAX_NUM_POINTS" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="TACKATTRS" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="VECTOR_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="POINTCLOUD_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="PEN_COLOR" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="XFORMER_NAME" PARM_VALUE="ImageFetcher__Rejected_"/>
#! <XFORM_PARM PARM_NAME="RASTER_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="THINNER_INTERVAL" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="RASTER_VISUALIZATION_OPTION" PARM_VALUE="No Reduction"/>
#! <XFORM_PARM PARM_NAME="TRANSFORMER_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="RASTER_NUM_ROWS" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="RASTER_START_COL" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="RASTER_NUM_COLS" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="THINNER_TYPE_DISPLAY" PARM_VALUE="No Thinning"/>
#! <XFORM_PARM PARM_NAME="RASTER_START_ROW" PARM_VALUE="&lt;Unused&gt;"/>
#! </TRANSFORMER>
#! </TRANSFORMERS>
#! <SUBDOCUMENT_IOS>
#! <SUBDOCUMENT_IO
#! IDENTIFIER="9"
#! NAME="Thumbnail"
#! POSITION="2051 -307"
#! COLLAPSED="true"
#! IS_SOURCE="false"
#! ATTR_MODE="0"
#! >
#! <XFORM_ATTR ATTR_NAME="_testServiceUrl" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.name" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.value" />
#! <XFORM_ATTR ATTR_NAME="_error" />
#! <XFORM_ATTR ATTR_NAME="_http_status_code" />
#! <XFORM_ATTR ATTR_NAME="footPrint" />
#! <XFORM_ATTR ATTR_NAME="json_type" />
#! <XFORM_ATTR ATTR_NAME="json_index" />
#! <XFORM_ATTR ATTR_NAME="url" />
#! <XFORM_ATTR ATTR_NAME="fme_type" />
#! <XFORM_ATTR ATTR_NAME="_url_contents" />
#! </SUBDOCUMENT_IO>
#! <SUBDOCUMENT_IO
#! IDENTIFIER="10"
#! NAME="Service"
#! POSITION="-1910 36"
#! COLLAPSED="true"
#! PUBLISHED="true"
#! IS_SOURCE="true"
#! ATTR_MODE="0"
#! >
#! <XFORM_ATTR ATTR_NAME="_testServiceUrl" ATTR_VALUE="$(_TESTSERVICEURL)" />
#! </SUBDOCUMENT_IO>
#! </SUBDOCUMENT_IOS>
#! <FEAT_LINKS>
#! <FEAT_LINK
#! IDENTIFIER="11"
#! SOURCE_NODE="10"
#! TARGET_NODE="1"
#! SOURCE_PORT_DESC="0"
#! TARGET_PORT_DESC="fi 0"
#! ENABLED="true"
#! EXTRA_POINTS=""
#! />
#! <FEAT_LINK
#! IDENTIFIER="12"
#! SOURCE_NODE="4"
#! TARGET_NODE="5"
#! SOURCE_PORT_DESC="fo 0"
#! TARGET_PORT_DESC="fi 0"
#! ENABLED="true"
#! EXTRA_POINTS=""
#! />
#! <FEAT_LINK
#! IDENTIFIER="13"
#! SOURCE_NODE="5"
#! TARGET_NODE="9"
#! SOURCE_PORT_DESC="fo 0"
#! TARGET_PORT_DESC="0"
#! ENABLED="true"
#! EXTRA_POINTS=""
#! />
#! <FEAT_LINK
#! IDENTIFIER="14"
#! SOURCE_NODE="6"
#! TARGET_NODE="4"
#! SOURCE_PORT_DESC="fo 0"
#! TARGET_PORT_DESC="fi 0"
#! ENABLED="true"
#! EXTRA_POINTS=""
#! />
#! <FEAT_LINK
#! IDENTIFIER="15"
#! SOURCE_NODE="6"
#! TARGET_NODE="5"
#! SOURCE_PORT_DESC="fo 1"
#! TARGET_PORT_DESC="fi 0"
#! ENABLED="true"
#! EXTRA_POINTS="978 -282"
#! />
#! <FEAT_LINK
#! IDENTIFIER="16"
#! SOURCE_NODE="3"
#! TARGET_NODE="6"
#! SOURCE_PORT_DESC="fo 0"
#! TARGET_PORT_DESC="fi 0"
#! ENABLED="true"
#! EXTRA_POINTS=""
#! />
#! <FEAT_LINK
#! IDENTIFIER="17"
#! SOURCE_NODE="1"
#! TARGET_NODE="7"
#! SOURCE_PORT_DESC="fo 0"
#! TARGET_PORT_DESC="fi 0"
#! ENABLED="true"
#! EXTRA_POINTS=""
#! />
#! <FEAT_LINK
#! IDENTIFIER="18"
#! SOURCE_NODE="7"
#! TARGET_NODE="3"
#! SOURCE_PORT_DESC="fo 0"
#! TARGET_PORT_DESC="fi 0"
#! ENABLED="true"
#! EXTRA_POINTS=""
#! />
#! <FEAT_LINK
#! IDENTIFIER="25"
#! SOURCE_NODE="6"
#! TARGET_NODE="24"
#! SOURCE_PORT_DESC="fo 0"
#! TARGET_PORT_DESC="fi 0"
#! ENABLED="true"
#! EXTRA_POINTS=""
#! />
#! <FEAT_LINK
#! IDENTIFIER="27"
#! SOURCE_NODE="24"
#! TARGET_NODE="26"
#! SOURCE_PORT_DESC="fo 0"
#! TARGET_PORT_DESC="fi 0"
#! ENABLED="true"
#! EXTRA_POINTS=""
#! />
#! <FEAT_LINK
#! IDENTIFIER="29"
#! SOURCE_NODE="24"
#! TARGET_NODE="28"
#! SOURCE_PORT_DESC="fo 1"
#! TARGET_PORT_DESC="fi 0"
#! ENABLED="true"
#! EXTRA_POINTS=""
#! />
#! </FEAT_LINKS>
#! <BREAKPOINTS>
#! </BREAKPOINTS>
#! <ATTR_LINKS>
#! </ATTR_LINKS>
#! <SUBDOCUMENTS>
#! </SUBDOCUMENTS>
#! <LOOKUP_TABLES>
#! </LOOKUP_TABLES>
#! </TRANSFORMER>
#! 
DEFAULT_MACRO $(GetServiceThumbnail_WORKSPACE_NAME)__TESTSERVICEURL <at>Value<openparen>_testServiceUrl<closeparen>
DEFAULT_MACRO $(GetServiceThumbnail_WORKSPACE_NAME)_DownloadImage No
#! START_HEADER
#! END_HEADER

LOG_FILTER_MASK -1
DEFAULT_MACRO WB_CURRENT_CONTEXT
DEFAULT_MACRO GetServiceThumbnail_WORKSPACE_NAME ""
INCLUDE [puts {MACRO WB_OLD_CONTEXT_$(GetServiceThumbnail_WORKSPACE_NAME) $(WB_CURRENT_CONTEXT)};          puts {MACRO WB_CURRENT_CONTEXT $(GetServiceThumbnail_WORKSPACE_NAME)}]
FACTORY_DEF * TeeFactory   FACTORY_NAME "$(GetServiceThumbnail_WORKSPACE_NAME)_Service1410868597 Input Splitter"   INPUT FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_Service"   OUTPUT FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_Service" "@EvaluateExpression(ATTR_CREATE_EXPR_PROPAGATE_MISSING,_testServiceUrl,$($(GetServiceThumbnail_WORKSPACE_NAME)__TESTSERVICEURL), FEATURE_TYPE)"
# -------------------------------------------------------------------------

FACTORY_DEF * HTTPFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_GetThumbnail       INPUT  FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_Service"    TARGET_URL @EvaluateExpression(STRING_ENCODED,<at>Value<openparen>_testServiceUrl<closeparen>?f=json<amp>option=footprints,$(GetServiceThumbnail_WORKSPACE_NAME)_GetThumbnail)    SAVE_FILE No    OUTPUT_FILENAME "<Unused>"    TARGET_ATTR "footPrint"    HTTP_METHOD GET    AUTH_METHOD Basic    SINGLE_SIGN_ON No    PROXY_AUTH_METHOD Basic    TARGET_ATTRIBUTE_ENCODING    RESPONSE_HEADER_LIST_ATTR "_headers"    STATUS_CODE_ATTR "_http_status_code"    ERROR_ATTR "_error"    FOLLOW_REDIRECTS Yes    VERIFY_SSL_CERTIFICATES No    USE_COOKIES No    OUTPUT OUTPUT FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_GetThumbnail_OUTPUT"    OUTPUT REJECTED FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_GetThumbnail_<REJECTED>"


FACTORY_DEF * TeeFactory   FACTORY_NAME "$(GetServiceThumbnail_WORKSPACE_NAME)_GetThumbnail <REJECTED> Output Nuker"   INPUT FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_GetThumbnail_<REJECTED>"
# -------------------------------------------------------------------------

FACTORY_DEF * JSONQueryFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_JSONFlattener    INPUT  FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_GetThumbnail_OUTPUT"    MODE FLATTEN    JSON_ATTR footPrint    EXPLODE_QUERY "json"    RECURSIVE_FLATTEN YES    OUTPUT EXPLODED FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_JSONFlattener_OUTPUT"

# -------------------------------------------------------------------------

FACTORY_DEF * TeeFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageRenamer    INPUT  FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_JSONFlattener_OUTPUT"    OUTPUT FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_ImageRenamer_OUTPUT"         @RenameAttributes(ATTR_LIST_DEF_VAL, featureCollection.layers{0}.featureSet.features{0}.attributes.thumbnail,ThumbnailURL,"")


# -------------------------------------------------------------------------

FACTORY_DEF * TestFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_Tester    INPUT  FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_ImageRenamer_OUTPUT"    TEST @EvaluateExpression(STRING_ENCODED,$($(GetServiceThumbnail_WORKSPACE_NAME)_DownloadImage$encode),$(GetServiceThumbnail_WORKSPACE_NAME)_Tester) = Yes ENCODED    BOOLEAN_OPERATOR OR    OUTPUT PASSED FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_Tester_PASSED"    OUTPUT FAILED FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_Tester_FAILED"
FACTORY_DEF * TeeFactory   FACTORY_NAME "$(GetServiceThumbnail_WORKSPACE_NAME)_Tester PASSED Splitter"   INPUT FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_Tester_PASSED"   OUTPUT FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_Tester_PASSED_0_MZYIfDk7x4I="   OUTPUT FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_Tester_PASSED_1_MZYIfDk7x4I="
# -------------------------------------------------------------------------

MACRO IMAGE_DATA_ATTRIBUTE _____image_data_____
MACRO IMAGE_FILE_ATTRIBUTE _____image_filename_____
FACTORY_DEF * TeeFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Gatherer    INPUT  FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_Tester_PASSED_0_MZYIfDk7x4I="    OUTPUT FEATURE_TYPE ___Gathered___
FACTORY_DEF * HTTPFactory    INPUT FEATURE_TYPE ___Gathered___       @RemoveGeometry()       @RemoveAttributes(fme_regexp_match,^fme*)    TARGET_URL @EvaluateExpression(STRING_ENCODED,<at>Value<openparen>ThumbnailURL<closeparen>,$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher)    HTTP_METHOD GET    TARGET_ATTR $(IMAGE_DATA_ATTRIBUTE)    USE_RESPONSE_ENCODING no    RESPONSE_HEADER_LIST_ATTR _____http_headers_____{}    AUTH_METHOD Basic    PROXY_AUTH_METHOD Basic    OUTPUT OUTPUT FEATURE_TYPE ___http_response___    OUTPUT REJECTED FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_<REJECTED>"       fme_type fme_no_geom       @SupplyAttributes(fme_basename,$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher)
# Only do the actual raster reading if our HTTP request was successful
# We can tell by looking at the value that comes back from the request --
# if it is blank, then we had a failure.  We need to check this so that
# if they continue on error, we can too.

FACTORY_DEF * TestFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_ResponseTester    INPUT FEATURE_TYPE ___http_response___    TEST @Value($(IMAGE_DATA_ATTRIBUTE)) != ""    OUTPUT PASSED FEATURE_TYPE ___non_empty_response___         @Tcl2("FME_SetAttribute $(IMAGE_FILE_ATTRIBUTE) [FME_TempFilename $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher]")         @File(DestWriteSrcRead,$(IMAGE_DATA_ATTRIBUTE),@Value($(IMAGE_FILE_ATTRIBUTE)))         @RemoveAttributes($(IMAGE_DATA_ATTRIBUTE))    OUTPUT FAILED FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_<REJECTED>"         fme_type fme_no_geom         @SupplyAttributes(fme_basename,$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher)
Tcl2 proc $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_detect_content_type { } {    if { [string compare {BMP} {AUTO}] == 0 } {       set index [FME_Execute SearchList "_____http_headers_____{}.name" "Content-Type"];       if { [string compare $index "-1"] != 0 } {          set mime [FME_GetAttribute "_____http_headers_____{$index}.value"];          if { [string match "image/*bmp*" $mime ] == 1 } {             return "BMP"          }          elseif { [string match "image/*gif*" $mime] == 1 } {             return "GIF"          }          elseif { [string match "image/*jpeg*" $mime] == 1 } {             return "JPEG"          }          elseif { [string match "image/*png*" $mime] == 1 } {             return "PNG"          }          elseif { [string match "image/*tiff*" $mime] == 1 } {             return "TIFF"          }          else          {             FME_LogMessage fme_warn 917355 $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher $mime;             return "UNKNOWN";          }       }       else       {          FME_LogMessage fme_warn 917356 $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher;          return "UNKNOWN";       }    }    else    {       return BMP    } }
FACTORY_DEF * TestFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_ContentTypeTester    INPUT FEATURE_TYPE ___non_empty_response___       _____image_type_____ @Tcl2("$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_detect_content_type")    TEST @Value(_____image_type_____) != UNKNOWN    OUTPUT PASSED FEATURE_TYPE ___has_content_type___       @RemoveAttributes(fme_regexp_match,^_____http_headers_____{[0-9]+}.*$)       @GlobalVariable($(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__packedAttrs__,@SupplyAttributes())    OUTPUT FAILED FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_<REJECTED>"       fme_type fme_no_geom       @SupplyAttributes(fme_basename,$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher)
# Now actually create the reader that will own the raster
# file and delete it when the feature is deleted so we won't
# leak temp files.

FACTORY_DEF * QueryFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Reader    INPUT FEATURE_TYPE ___has_content_type___    READER_TYPE @Value(_____image_type_____)    READER_DATASET @Value($(IMAGE_FILE_ATTRIBUTE))    CONTINUE_ON_READER_ERROR YES    READER_PARAMS    DELETE_SOURCE_ON_CLOSE yes    OUTPUT RESULT FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_RASTER"         @SupplyAttributes(@GlobalVariable($(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__packedAttrs__))         @RemoveAttributes($(IMAGE_FILE_ATTRIBUTE),_____image_type_____)         @SupplyAttributes(fme_basename,$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher)    OUTPUT READER_ERROR FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_<REJECTED>"         fme_type fme_no_geom         @SupplyAttributes(fme_basename,$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher)

# -------------------------------------------------------------------------

# Set the directive to add all the meta-attributes to the features.
# We do this so users see all possible information in the viewed
# features.

READER_META_ATTRIBUTES fme_feature_type fme_dataset fme_basename
# Assumption is that the workspace temp dir has been already set and created.  See controldefs.cpp - ControlDefs::writeVisualizerTempDir
DEFAULT_MACRO WORKSPACE_TEMP_DIR
INCLUDE [         if { [string length {}] > 0 } {             set catter "" ;             set comma "" ;             foreach attr {} {                 set catter "$catter$comma@Value(\"$attr\")" ;                 set comma ",_," ;             } ;             puts "MACRO CATMAC _@Concatenate($catter)" ;         }         else {             puts "MACRO CATMAC " ;         };         set safeName "[regsub -all {[^a-zA-Z0-9]} {$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected_} _]_[expr round(rand() * 1000000)]_[clock clicks  -milliseconds]";         puts "MACRO SAFE_FFS_NAME $safeName";         ]
# Make the temporary directory that the FFS files will live in.
FACTORY_DEF * CreationFactory      FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected__DirCreator      OUTPUT FEATURE_TYPE __nukeme__          @Tcl2("catch {file mkdir {$(WORKSPACE_TEMP_DIR)}}")
FACTORY_DEF * TeeFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected__DirCreatorCleanerUpper    INPUT FEATURE_TYPE __nukeme__
# Send raster, point cloud and vector features down different paths to prepare
# them for viewing

FACTORY_DEF * TestFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected__FeatureDirector    INPUT  FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_<REJECTED>"    TEST &fme_type == "fme_raster"    OUTPUT FAILED FEATURE_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected____NotRasterFeatures___    OUTPUT PASSED FEATURE_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected____RasterFeatures___
FACTORY_DEF * TestFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected____FeatureDirector1    INPUT FEATURE_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected____NotRasterFeatures___    TEST &fme_type == "fme_point_cloud"    OUTPUT FAILED FEATURE_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected____VectorFeatures___    OUTPUT PASSED FEATURE_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected____PointCloudFeatures___
# Vector features simply may get their colors overridden

FACTORY_DEF * TeeFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected__VectorSetterUpper    INPUT FEATURE_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected____VectorFeatures___    OUTPUT FEATURE_TYPE __viewme__
# Point Cloud Features Might Need to be thinned

# Note that we don't call the ThinPointCloud function directly, but rather
# do it through TCL. This should allow this transformer to be used with a
# Desktop license, even though ThinPointCloud requires Professional.

Tcl2 proc $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected__ef51c0af_4f5c_4534_a0c7_c79e60f042150_thinPointCloud {} {    if {[string equal {NO_THINNING} {KEEPNPOINT}]}    {       FME_Execute ThinPointCloud NO_THINNING <Unused>;    }    elseif {[string equal {NO_THINNING} {MAXNUMPOINTS}]}    {       FME_Execute ThinPointCloud NO_THINNING <Unused>;    }    elseif {[string equal {NO_THINNING} {FIRSTNPOINTS}]}    {       FME_Execute ThinPointCloud NO_THINNING <Unused>;    }    elseif {[string equal {NO_THINNING} {LASTNPOINTS}]}    {       FME_Execute ThinPointCloud NO_THINNING <Unused>;    }; }
FACTORY_DEF * TeeFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected____PointCloudThinner    INPUT FEATURE_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected____PointCloudFeatures___    OUTPUT FEATURE_TYPE __viewme__       @Tcl2("$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected__ef51c0af_4f5c_4534_a0c7_c79e60f042150_thinPointCloud")
Tcl2 proc $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected__ef51c0af_4f5c_4534_a0c7_c79e60f042150_prepareRaster {subsetStartRow subsetNumRows subsetStartCol subsetNumCols} {    set useDI [string equal -nocase {$(FME_VIEWER_APP)} {fmedatainspector}];    if {!$useDI} {       FME_Execute ApplyRasterRotation BILINEAR;    };    set doResample [string equal {NoReduction} {Resample}];    set doSubset [string equal {NoReduction} {Subset}];    set doBounds [string equal {NoReduction} {BoundingBoxOnly}];    if {$doBounds}  {       FME_Execute GeometryType fme_polygon;    }    elseif {$doResample || $doSubset} {       set comment {          First, we need to prefix all the attributes. This is done because          we are going to call @RasterProperties, and we want to make sure          it doesn't overwrite any existing attributes.       };       set kAttrPrefix ".";       set allNames [FME_AttributeNames];       foreach oldName $allNames {          set newName $kAttrPrefix;          append newName $oldName;          FME_RenameAttribute $newName $oldName;       };       FME_Execute RasterProperties RASTER;       if {$doResample} {          set oldNumCols [FME_GetAttribute _num_columns];          set oldNumRows [FME_GetAttribute _num_rows];          set oldSpacingX [FME_GetAttribute _spacing_x];          set oldSpacingY [FME_GetAttribute _spacing_y];          set kMinNumCells 32;          set kMaxNumCells 512;          set comment {             We will only resample if both dimensions are greater than the             minimum num cells, and at least one is greater than the maximum.          };          if {$oldNumRows > $kMinNumCells && $oldNumCols > $kMinNumCells && ($oldNumRows > $kMaxNumCells || $oldNumCols > $kMaxNumCells)} {             set newSpacingX 1.0;             set newSpacingY 1.0;             if {$oldNumRows > $oldNumCols} {                set comment {                   If we have more rows than columns, we need to choose a spacing                   that reduces the number of rows to the maximum we've chosen.                };                set newSpacingY [expr 1.0 * $oldNumRows * $oldSpacingY / $kMaxNumCells];                set newSpacingX [expr 1.0 * $newSpacingY / $oldSpacingY * $oldSpacingX];                set comment {                   Now we need to check if doing this will result in the columns                   going below the minimum. If so, choose the spacing such that                   we only go down to the minimum (and not past).                };                set newNumCols [expr $oldNumCols * $oldSpacingX / $newSpacingX];                if {$newNumCols < $kMinNumCells}                {                   set newSpacingX [expr 1.0 * $oldNumCols * $oldSpacingX / $kMinNumCells];                   set newSpacingY [expr 1.0 * $newSpacingX / $oldSpacingX * $oldSpacingY];                };             }             else {                set comment {                   This is identical to the above case, except the roles of                   rows and cols are reversed.                };                set newSpacingX [expr 1.0 * $oldNumCols * $oldSpacingX / $kMaxNumCells];                set newSpacingY [expr 1.0 * $newSpacingX / $oldSpacingX * $oldSpacingY];                set newNumRows [expr $oldNumRows * $oldSpacingY / $newSpacingY];                if {$newNumRows < $kMinNumCells}                {                   set newSpacingY [expr 1.0 * $oldNumRows * $oldSpacingY / $kMinNumCells];                   set newSpacingX [expr 1.0 * $newSpacingY / $oldSpacingY * $oldSpacingX];                };             };             FME_Execute ResampleRaster CELL_SIZE $newSpacingX $newSpacingY NearestNeighbor;          };       }       elseif {$doSubset} {          set comment {             Get the value of some strings that may be attributes or constants.             Note that we pass in the attribute prefix we're using, because if             one does turn out to be an attribute, it won't actually be the exact             name in the string (since we renamed all our attributes above).          };          set rasterNumRows [FME_GetAttribute _num_rows];          set rasterNumCols [FME_GetAttribute _num_columns];          set comment {             Only do subsetting if the specified start position is actually             within the raster.          };          if {$subsetStartRow < $rasterNumRows && $subsetStartCol < $rasterNumCols}          {             set comment {                Now bound the subset to the size of the raster, so that                we don't create padding.             };             if {[expr $subsetStartRow + $subsetNumRows] > $rasterNumRows}             {                set subsetNumRows [expr $rasterNumRows - $subsetStartRow];             };             if {[expr $subsetStartCol + $subsetNumCols] > $rasterNumCols}             {                set subsetNumCols [expr $rasterNumCols - $subsetStartCol];             };             FME_Execute SubsetRaster $subsetStartRow $subsetNumRows $subsetStartCol $subsetNumCols;          };       };       set comment {          Remove all the attributes added by @RasterProperties and remove the          prefix from the real attributes. We assume they all start with an          underscore.       };       FME_Execute RemoveAttributes fme_regexp_match {^_};       foreach oldName $allNames {          set newName $kAttrPrefix;          append newName $oldName;          FME_RenameAttribute $oldName $newName;       };    }; }
FACTORY_DEF * TeeFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected__RasterSetterUpper    INPUT FEATURE_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected____RasterFeatures___    OUTPUT FEATURE_TYPE __viewme__       @Tcl2("$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected__ef51c0af_4f5c_4534_a0c7_c79e60f042150_prepareRaster {<Unused>} {<Unused>} {<Unused>} {<Unused>}")
# Now route all the features into the recorder, changing their
# feature type to the transformer name so that they view nicely
# $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected__ef51c0af_4f5c_4534_a0c7_c79e60f042150_VIS_FEAT_TYPE changes the feature types
# of the features being visualized.

DEFAULT_MACRO $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected__ef51c0af_4f5c_4534_a0c7_c79e60f042150_VIS_FEAT_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected_$(CATMAC)
DEFAULT_MACRO VISUALIZER_FEATURE_FILE $(WORKSPACE_TEMP_DIR)/$(SAFE_FFS_NAME).ffs
DEFAULT_MACRO VISUALIZER_CREATE_SPATIAL_INDEX NO
# [PR#45549] The Data Inspector will limit the maximum number of features
# it reads on WIN32, so we will correspondingly limit the number of
# features we record here using the MAX_FEATURES_TO_RECORD directive.

FACTORY_DEF * RecorderFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected__Recorder    INPUT FEATURE_TYPE __viewme__  _wb_termination_feature Yes @FeatureType(TERMINATOR_@Value(_wb_termination_xformer))    INPUT FEATURE_TYPE __viewme__  @FeatureType($($(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher__Rejected__ef51c0af_4f5c_4534_a0c7_c79e60f042150_VIS_FEAT_TYPE))    FEATURE_FILE "$(VISUALIZER_FEATURE_FILE)"    CREATE_SPATIAL_INDEX "$(VISUALIZER_CREATE_SPATIAL_INDEX)"    INSPECTOR "$(VISUALIZER_CREATE_SPATIAL_INDEX)"    FSC_SCHEMA _testServiceUrl,varchar<openparen>255<closeparen>,_error,varchar<openparen>255<closeparen>,_http_status_code,varchar<openparen>255<closeparen>,footPrint,varchar<openparen>255<closeparen>,ThumbnailURL,varchar<openparen>255<closeparen>,fme_basename,varchar<openparen>255<closeparen>    MODE RECORD    RECORD_DIRECTLY_TO_DISK YES    MAX_FEATURES_TO_RECORD WIN32 2000000

# -------------------------------------------------------------------------

# Set the directive to add all the meta-attributes to the features.
# We do this so users see all possible information in the viewed
# features.

READER_META_ATTRIBUTES fme_feature_type fme_dataset fme_basename
# Assumption is that the workspace temp dir has been already set and created.  See controldefs.cpp - ControlDefs::writeVisualizerTempDir
DEFAULT_MACRO WORKSPACE_TEMP_DIR
INCLUDE [         if { [string length {}] > 0 } {             set catter "" ;             set comma "" ;             foreach attr {} {                 set catter "$catter$comma@Value(\"$attr\")" ;                 set comma ",_," ;             } ;             puts "MACRO CATMAC _@Concatenate($catter)" ;         }         else {             puts "MACRO CATMAC " ;         };         set safeName "[regsub -all {[^a-zA-Z0-9]} {$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster} _]_[expr round(rand() * 1000000)]_[clock clicks  -milliseconds]";         puts "MACRO SAFE_FFS_NAME $safeName";         ]
# Make the temporary directory that the FFS files will live in.
FACTORY_DEF * CreationFactory      FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster_DirCreator      OUTPUT FEATURE_TYPE __nukeme__          @Tcl2("catch {file mkdir {$(WORKSPACE_TEMP_DIR)}}")
FACTORY_DEF * TeeFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster_DirCreatorCleanerUpper    INPUT FEATURE_TYPE __nukeme__
# Send raster, point cloud and vector features down different paths to prepare
# them for viewing

FACTORY_DEF * TestFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster_FeatureDirector    INPUT  FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_RASTER"    TEST &fme_type == "fme_raster"    OUTPUT FAILED FEATURE_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster___NotRasterFeatures___    OUTPUT PASSED FEATURE_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster___RasterFeatures___
FACTORY_DEF * TestFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster___FeatureDirector1    INPUT FEATURE_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster___NotRasterFeatures___    TEST &fme_type == "fme_point_cloud"    OUTPUT FAILED FEATURE_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster___VectorFeatures___    OUTPUT PASSED FEATURE_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster___PointCloudFeatures___
# Vector features simply may get their colors overridden

FACTORY_DEF * TeeFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster_VectorSetterUpper    INPUT FEATURE_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster___VectorFeatures___    OUTPUT FEATURE_TYPE __viewme__
# Point Cloud Features Might Need to be thinned

# Note that we don't call the ThinPointCloud function directly, but rather
# do it through TCL. This should allow this transformer to be used with a
# Desktop license, even though ThinPointCloud requires Professional.

Tcl2 proc $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster_8209d59b_eaa0_42b6_98c5_af7e33f5d4350_thinPointCloud {} {    if {[string equal {NO_THINNING} {KEEPNPOINT}]}    {       FME_Execute ThinPointCloud NO_THINNING <Unused>;    }    elseif {[string equal {NO_THINNING} {MAXNUMPOINTS}]}    {       FME_Execute ThinPointCloud NO_THINNING <Unused>;    }    elseif {[string equal {NO_THINNING} {FIRSTNPOINTS}]}    {       FME_Execute ThinPointCloud NO_THINNING <Unused>;    }    elseif {[string equal {NO_THINNING} {LASTNPOINTS}]}    {       FME_Execute ThinPointCloud NO_THINNING <Unused>;    }; }
FACTORY_DEF * TeeFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster___PointCloudThinner    INPUT FEATURE_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster___PointCloudFeatures___    OUTPUT FEATURE_TYPE __viewme__       @Tcl2("$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster_8209d59b_eaa0_42b6_98c5_af7e33f5d4350_thinPointCloud")
Tcl2 proc $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster_8209d59b_eaa0_42b6_98c5_af7e33f5d4350_prepareRaster {subsetStartRow subsetNumRows subsetStartCol subsetNumCols} {    set useDI [string equal -nocase {$(FME_VIEWER_APP)} {fmedatainspector}];    if {!$useDI} {       FME_Execute ApplyRasterRotation BILINEAR;    };    set doResample [string equal {NoReduction} {Resample}];    set doSubset [string equal {NoReduction} {Subset}];    set doBounds [string equal {NoReduction} {BoundingBoxOnly}];    if {$doBounds}  {       FME_Execute GeometryType fme_polygon;    }    elseif {$doResample || $doSubset} {       set comment {          First, we need to prefix all the attributes. This is done because          we are going to call @RasterProperties, and we want to make sure          it doesn't overwrite any existing attributes.       };       set kAttrPrefix ".";       set allNames [FME_AttributeNames];       foreach oldName $allNames {          set newName $kAttrPrefix;          append newName $oldName;          FME_RenameAttribute $newName $oldName;       };       FME_Execute RasterProperties RASTER;       if {$doResample} {          set oldNumCols [FME_GetAttribute _num_columns];          set oldNumRows [FME_GetAttribute _num_rows];          set oldSpacingX [FME_GetAttribute _spacing_x];          set oldSpacingY [FME_GetAttribute _spacing_y];          set kMinNumCells 32;          set kMaxNumCells 512;          set comment {             We will only resample if both dimensions are greater than the             minimum num cells, and at least one is greater than the maximum.          };          if {$oldNumRows > $kMinNumCells && $oldNumCols > $kMinNumCells && ($oldNumRows > $kMaxNumCells || $oldNumCols > $kMaxNumCells)} {             set newSpacingX 1.0;             set newSpacingY 1.0;             if {$oldNumRows > $oldNumCols} {                set comment {                   If we have more rows than columns, we need to choose a spacing                   that reduces the number of rows to the maximum we've chosen.                };                set newSpacingY [expr 1.0 * $oldNumRows * $oldSpacingY / $kMaxNumCells];                set newSpacingX [expr 1.0 * $newSpacingY / $oldSpacingY * $oldSpacingX];                set comment {                   Now we need to check if doing this will result in the columns                   going below the minimum. If so, choose the spacing such that                   we only go down to the minimum (and not past).                };                set newNumCols [expr $oldNumCols * $oldSpacingX / $newSpacingX];                if {$newNumCols < $kMinNumCells}                {                   set newSpacingX [expr 1.0 * $oldNumCols * $oldSpacingX / $kMinNumCells];                   set newSpacingY [expr 1.0 * $newSpacingX / $oldSpacingX * $oldSpacingY];                };             }             else {                set comment {                   This is identical to the above case, except the roles of                   rows and cols are reversed.                };                set newSpacingX [expr 1.0 * $oldNumCols * $oldSpacingX / $kMaxNumCells];                set newSpacingY [expr 1.0 * $newSpacingX / $oldSpacingX * $oldSpacingY];                set newNumRows [expr $oldNumRows * $oldSpacingY / $newSpacingY];                if {$newNumRows < $kMinNumCells}                {                   set newSpacingY [expr 1.0 * $oldNumRows * $oldSpacingY / $kMinNumCells];                   set newSpacingX [expr 1.0 * $newSpacingY / $oldSpacingY * $oldSpacingX];                };             };             FME_Execute ResampleRaster CELL_SIZE $newSpacingX $newSpacingY NearestNeighbor;          };       }       elseif {$doSubset} {          set comment {             Get the value of some strings that may be attributes or constants.             Note that we pass in the attribute prefix we're using, because if             one does turn out to be an attribute, it won't actually be the exact             name in the string (since we renamed all our attributes above).          };          set rasterNumRows [FME_GetAttribute _num_rows];          set rasterNumCols [FME_GetAttribute _num_columns];          set comment {             Only do subsetting if the specified start position is actually             within the raster.          };          if {$subsetStartRow < $rasterNumRows && $subsetStartCol < $rasterNumCols}          {             set comment {                Now bound the subset to the size of the raster, so that                we don't create padding.             };             if {[expr $subsetStartRow + $subsetNumRows] > $rasterNumRows}             {                set subsetNumRows [expr $rasterNumRows - $subsetStartRow];             };             if {[expr $subsetStartCol + $subsetNumCols] > $rasterNumCols}             {                set subsetNumCols [expr $rasterNumCols - $subsetStartCol];             };             FME_Execute SubsetRaster $subsetStartRow $subsetNumRows $subsetStartCol $subsetNumCols;          };       };       set comment {          Remove all the attributes added by @RasterProperties and remove the          prefix from the real attributes. We assume they all start with an          underscore.       };       FME_Execute RemoveAttributes fme_regexp_match {^_};       foreach oldName $allNames {          set newName $kAttrPrefix;          append newName $oldName;          FME_RenameAttribute $oldName $newName;       };    }; }
FACTORY_DEF * TeeFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster_RasterSetterUpper    INPUT FEATURE_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster___RasterFeatures___    OUTPUT FEATURE_TYPE __viewme__       @Tcl2("$(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster_8209d59b_eaa0_42b6_98c5_af7e33f5d4350_prepareRaster {<Unused>} {<Unused>} {<Unused>} {<Unused>}")
# Now route all the features into the recorder, changing their
# feature type to the transformer name so that they view nicely
# $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster_8209d59b_eaa0_42b6_98c5_af7e33f5d4350_VIS_FEAT_TYPE changes the feature types
# of the features being visualized.

DEFAULT_MACRO $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster_8209d59b_eaa0_42b6_98c5_af7e33f5d4350_VIS_FEAT_TYPE $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster$(CATMAC)
DEFAULT_MACRO VISUALIZER_FEATURE_FILE $(WORKSPACE_TEMP_DIR)/$(SAFE_FFS_NAME).ffs
DEFAULT_MACRO VISUALIZER_CREATE_SPATIAL_INDEX NO
# [PR#45549] The Data Inspector will limit the maximum number of features
# it reads on WIN32, so we will correspondingly limit the number of
# features we record here using the MAX_FEATURES_TO_RECORD directive.

FACTORY_DEF * RecorderFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster_Recorder    INPUT FEATURE_TYPE __viewme__  _wb_termination_feature Yes @FeatureType(TERMINATOR_@Value(_wb_termination_xformer))    INPUT FEATURE_TYPE __viewme__  @FeatureType($($(GetServiceThumbnail_WORKSPACE_NAME)_ImageFetcher_Raster_8209d59b_eaa0_42b6_98c5_af7e33f5d4350_VIS_FEAT_TYPE))    FEATURE_FILE "$(VISUALIZER_FEATURE_FILE)"    CREATE_SPATIAL_INDEX "$(VISUALIZER_CREATE_SPATIAL_INDEX)"    INSPECTOR "$(VISUALIZER_CREATE_SPATIAL_INDEX)"    FSC_SCHEMA _testServiceUrl,varchar<openparen>255<closeparen>,_error,varchar<openparen>255<closeparen>,_http_status_code,varchar<openparen>255<closeparen>,footPrint,varchar<openparen>255<closeparen>,ThumbnailURL,varchar<openparen>255<closeparen>,fme_basename,varchar<openparen>255<closeparen>    MODE RECORD    RECORD_DIRECTLY_TO_DISK YES    MAX_FEATURES_TO_RECORD WIN32 2000000

# -------------------------------------------------------------------------

FACTORY_DEF * HTTPFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_HTTPFetcher       INPUT  FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_Tester_PASSED_1_MZYIfDk7x4I="    TARGET_URL @EvaluateExpression(STRING_ENCODED,<at>Value<openparen>ThumbnailURL<closeparen>,$(GetServiceThumbnail_WORKSPACE_NAME)_HTTPFetcher)    SAVE_FILE No    OUTPUT_FILENAME "<Unused>"    TARGET_ATTR "Thumbnaill"    HTTP_METHOD GET    AUTH_METHOD Basic    SINGLE_SIGN_ON No    PROXY_AUTH_METHOD Basic    TARGET_ATTRIBUTE_ENCODING    RESPONSE_HEADER_LIST_ATTR "_headers"    STATUS_CODE_ATTR "_http_status_code"    ERROR_ATTR "_error"    FOLLOW_REDIRECTS Yes    VERIFY_SSL_CERTIFICATES No    USE_COOKIES No    OUTPUT OUTPUT FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_HTTPFetcher_OUTPUT"    OUTPUT REJECTED FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_HTTPFetcher_<REJECTED>"


FACTORY_DEF * TeeFactory   FACTORY_NAME "$(GetServiceThumbnail_WORKSPACE_NAME)_HTTPFetcher <REJECTED> Output Nuker"   INPUT FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_HTTPFetcher_<REJECTED>"
# -------------------------------------------------------------------------

INCLUDE [    set macroLine "MACRO $(GetServiceThumbnail_WORKSPACE_NAME)_AttributeRemover_LIST_EXP ";    foreach attr [split "_headers<opencurly><closecurly>.value _headers<opencurly><closecurly>.name _headers<opencurly><closecurly>"] {       set attr [FME_DecodeText $attr];       set attr [regsub "{}$" $attr "{}.*"];       set attr [regsub -all "{}" $attr "{\[0-9\]+}"];       append macroLine ",^$attr$";    };    puts $macroLine; ]
FACTORY_DEF * TeeFactory    FACTORY_NAME $(GetServiceThumbnail_WORKSPACE_NAME)_AttributeRemover    INPUT  FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_Tester_FAILED"    INPUT  FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_HTTPFetcher_OUTPUT"    OUTPUT FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_AttributeRemover_OUTPUT"        @RemoveAttributes(_error,_http_status_code,footPrint,json_type,json_index,fme_type)        @RemoveAttributes(fme_regexp_match"$($(GetServiceThumbnail_WORKSPACE_NAME)_AttributeRemover_LIST_EXP)")

FACTORY_DEF * TeeFactory   FACTORY_NAME "$(GetServiceThumbnail_WORKSPACE_NAME)_Thumbnail1410868597 Output Collector"   INPUT FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_AttributeRemover_OUTPUT"   OUTPUT FEATURE_TYPE "$(GetServiceThumbnail_WORKSPACE_NAME)_Thumbnail"
INCLUDE [puts {MACRO WB_CURRENT_CONTEXT $(WB_OLD_CONTEXT_$(GetServiceThumbnail_WORKSPACE_NAME))}]
