#! <?xml version="1.0" encoding="windows-1252" ?>
#! <TRANSFORMER
# TRANSFORMER_BEGIN AGO_WebMap,1,"ArcGis online",96cbcb8e-5af3-4617-a47a-255fa15a9a42,"Linked by Default",No,NO_PARALLELISM,,No,14338,YES,No
# <p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Get the JSON string from a webmap </p>
# 
# TRANSFORMER_END
#! PASSWORD=""
#! ATTR_TYPE_ENCODING="SDF"
#! VIEW_POSITION="-1935 477"
#! SHOW_INFO_NODES="true"
#! FME_LINKED_TRANSFORMER_VERSION="1"
#! FMX_INSERT_MODE="Linked by Default"
#! BLOCKED_LOOPING="No"
#! DESCRIPTION="&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;Get the JSON string from a webmap &lt;/p&gt;&#10;"
#! TITLE="AGO_WebMap"
#! MAX_LOOP_ITERATIONS=""
#! ITERATION_COUNT_ATTR=""
#! FME_BUILD_NUM="14338"
#! ZOOM_SCALE="100"
#! CATEGORY="ArcGis online"
#! LEGAL_TERMS_CONDITIONS="&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;&#10;    &lt;br/&gt;&#10;&lt;/p&gt;&#10;"
#! FME_PROCESS_GROUP_BY=""
#! USAGE="&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;&#10;    &lt;br/&gt;&#10;&lt;/p&gt;&#10;"
#! HISTORY=""
#! FME_DOCUMENT_PRIORGUID="46441090-d812-40cf-85ad-92fbd130e74f,c562bf11-8bed-4925-b77d-f360e7e0a826"
#! DOC_TOP_LEFT="-1987 181"
#! XFORM_DEPRECATED="No"
#! REQUIREMENTS_KEYWORD="none"
#! LAST_SAVE_DATE="2014-07-21T17:56:42"
#! WORKSPACE_VERSION="1"
#! LAST_SAVE_BUILD="FME(R) 2014 SP2 (20140606 - Build 14338 - WIN64)"
#! FME_SERVER_SERVICES=""
#! REQUIREMENTS="&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt;&#10;    &lt;br/&gt;&#10;&lt;/p&gt;&#10;"
#! DOC_EXTENTS="2414 20"
#! FME_DOCUMENT_GUID="96cbcb8e-5af3-4617-a47a-255fa15a9a42"
#! FME_PROCESS_COUNT="NO_PARALLELISM"
#! SHOW_ANNOTATIONS="true"
#! FME_PROCESS_GROUPS_ORDERED="No"
#! WARN_INVALID_XFORM_PARAM="Yes"
#! >
#! <DATASETS>
#! </DATASETS>
#! <DATA_TYPES>
#! </DATA_TYPES>
#! <GEOM_TYPES>
#! </GEOM_TYPES>
#! <FEATURE_TYPES>
#! </FEATURE_TYPES>
#! <FMESERVER>
#! </FMESERVER>
#! <GLOBAL_PARAMETERS>
#! <GLOBAL_PARAMETER
#! GUI_LINE="GUI TEXT_OR_ATTR ArcGisToken ArcGis online authentication token:"
#! DEFAULT_VALUE=""
#! IS_STAND_ALONE="true"
#! />
#! <GLOBAL_PARAMETER
#! GUI_LINE="GUI TEXT_OR_ATTR referer ArcGins online referer:"
#! DEFAULT_VALUE="https://www.arcgis.com"
#! IS_STAND_ALONE="true"
#! />
#! <GLOBAL_PARAMETER
#! GUI_LINE="GUI TEXT_OR_ATTR WebmapID Web map id:"
#! DEFAULT_VALUE=""
#! IS_STAND_ALONE="true"
#! />
#! </GLOBAL_PARAMETERS>
#! <COMMENTS>
#! </COMMENTS>
#! <CONSTANTS>
#! </CONSTANTS>
#! <BOOKMARKS>
#! </BOOKMARKS>
#! <TRANSFORMERS>
#! <TRANSFORMER
#! IDENTIFIER="1"
#! TYPE="HTTPUploader"
#! VERSION="3"
#! POSITION="-194 197"
#! ORDER="5e+014"
#! PARMS_EDITED="true"
#! ENABLED="true"
#! >
#! <OUTPUT_FEAT NAME="OUTPUT"/>
#! <FEAT_COLLAPSED COLLAPSED="0"/>
#! <XFORM_ATTR ATTR_NAME="ArcGis_token" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_referer" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_WebmapID" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="urlGetWebMap" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.name" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.value" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_error" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_http_status_code" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="webMapJson" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <OUTPUT_FEAT NAME="&lt;REJECTED&gt;"/>
#! <FEAT_COLLAPSED COLLAPSED="1"/>
#! <XFORM_ATTR ATTR_NAME="ArcGis_token" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_referer" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_WebmapID" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="urlGetWebMap" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.name" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_headers{}.value" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_error" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="_http_status_code" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_ATTR ATTR_NAME="webMapJson" IS_USER_CREATED="false" FEAT_INDEX="1" />
#! <XFORM_PARM PARM_NAME="HTTP_AUTH_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="TARGET_URL" PARM_VALUE="&lt;at&gt;Value&lt;openparen&gt;urlGetWebMap&lt;closeparen&gt;"/>
#! <XFORM_PARM PARM_NAME="REQUEST_HEADER" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="PROXY_PASSWORD" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="PROXY_PORT" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="STATUS_CODE_ATTR" PARM_VALUE="_http_status_code"/>
#! <XFORM_PARM PARM_NAME="HTTP_REQUEST_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="UPLOAD_CONTENT_TYPE" PARM_VALUE="application/x-www-form-urlencoded"/>
#! <XFORM_PARM PARM_NAME="TARGET_ATTR_ENCODING" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="AUTH_USERNAME" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="AUTH_PASSWORD" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="PROXY_USERNAME" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="PROXY_AUTH_METHOD" PARM_VALUE="Basic"/>
#! <XFORM_PARM PARM_NAME="UPLOAD_BODY" PARM_VALUE="f=json&lt;amp&gt;token=&lt;at&gt;Value&lt;openparen&gt;ArcGis_token&lt;closeparen&gt;"/>
#! <XFORM_PARM PARM_NAME="PROXY_URL" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="UPLOAD_METHOD" PARM_VALUE="POST"/>
#! <XFORM_PARM PARM_NAME="XFORMER_NAME" PARM_VALUE="HTTPUploader"/>
#! <XFORM_PARM PARM_NAME="TRANSFORMER_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="FOLLOW_REDIRECTS" PARM_VALUE="Yes"/>
#! <XFORM_PARM PARM_NAME="RESPONSE_HEADER_LIST_ATTR" PARM_VALUE="_headers"/>
#! <XFORM_PARM PARM_NAME="ERROR_ATTR" PARM_VALUE="_error"/>
#! <XFORM_PARM PARM_NAME="HTTP_RESPONSE_GROUP" PARM_VALUE=""/>
#! <XFORM_PARM PARM_NAME="USE_COOKIES" PARM_VALUE="No"/>
#! <XFORM_PARM PARM_NAME="VERIFY_SSL_CERTIFICATES" PARM_VALUE="Yes"/>
#! <XFORM_PARM PARM_NAME="AUTH_METHOD" PARM_VALUE="Basic"/>
#! <XFORM_PARM PARM_NAME="TARGET_ATTR" PARM_VALUE="webMapJson"/>
#! <XFORM_PARM PARM_NAME="PROXY_GROUP" PARM_VALUE=""/>
#! </TRANSFORMER>
#! <TRANSFORMER
#! IDENTIFIER="7"
#! TYPE="AttributeCreator"
#! VERSION="4"
#! POSITION="-786 186"
#! ORDER="5e+014"
#! PARMS_EDITED="true"
#! ENABLED="true"
#! >
#! <OUTPUT_FEAT NAME="OUTPUT"/>
#! <FEAT_COLLAPSED COLLAPSED="0"/>
#! <XFORM_ATTR ATTR_NAME="ArcGis_token" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_referer" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_WebmapID" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="urlGetWebMap" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_PARM PARM_NAME="NUM_PRIOR_FEATURES" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="MULTI_FEATURE_MODE" PARM_VALUE="NO"/>
#! <XFORM_PARM PARM_NAME="XFORMER_NAME" PARM_VALUE="AttributeCreator_2"/>
#! <XFORM_PARM PARM_NAME="NULL_ATTR_MODE_DISPLAY" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="NUM_SUBSEQUENT_FEATURES" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="NULL_ATTR_VALUE" PARM_VALUE="&lt;Unused&gt;"/>
#! <XFORM_PARM PARM_NAME="ATTR_LIST" PARM_VALUE="urlGetWebMap,&lt;at&gt;Value&lt;openparen&gt;_referer&lt;closeparen&gt;&lt;solidus&gt;sharing&lt;solidus&gt;rest&lt;solidus&gt;content&lt;solidus&gt;items&lt;solidus&gt;&lt;at&gt;Value&lt;openparen&gt;_WebmapID&lt;closeparen&gt;&lt;solidus&gt;data"/>
#! </TRANSFORMER>
#! <TRANSFORMER
#! IDENTIFIER="8"
#! TYPE="ParameterFetcher"
#! VERSION="4"
#! POSITION="-1398 196"
#! ORDER="5e+014"
#! PARMS_EDITED="true"
#! ENABLED="true"
#! >
#! <OUTPUT_FEAT NAME="OUTPUT"/>
#! <FEAT_COLLAPSED COLLAPSED="0"/>
#! <XFORM_ATTR ATTR_NAME="ArcGis_token" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_referer" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_ATTR ATTR_NAME="_WebmapID" IS_USER_CREATED="false" FEAT_INDEX="0" />
#! <XFORM_PARM PARM_NAME="XFORMER_NAME" PARM_VALUE="ParameterFetcher"/>
#! <XFORM_PARM PARM_NAME="ATTR_LIST" PARM_VALUE="ArcGis_token {$(ArcGisToken)} _referer {$(referer)} _WebmapID {$(WebmapID)}"/>
#! </TRANSFORMER>
#! </TRANSFORMERS>
#! <SUBDOCUMENT_IOS>
#! <SUBDOCUMENT_IO
#! IDENTIFIER="4"
#! NAME="WebMap"
#! POSITION="427 201"
#! COLLAPSED="false"
#! IS_SOURCE="false"
#! ATTR_MODE="1"
#! >
#! <XFORM_ATTR ATTR_NAME="ArcGis_token" />
#! <XFORM_ATTR ATTR_NAME="webMapJson" />
#! </SUBDOCUMENT_IO>
#! <SUBDOCUMENT_IO
#! IDENTIFIER="10"
#! NAME="Input"
#! POSITION="-1987 181"
#! COLLAPSED="true"
#! PUBLISHED="true"
#! IS_SOURCE="true"
#! ATTR_MODE="0"
#! >
#! </SUBDOCUMENT_IO>
#! </SUBDOCUMENT_IOS>
#! <FEAT_LINKS>
#! <FEAT_LINK
#! IDENTIFIER="28"
#! SOURCE_NODE="7"
#! TARGET_NODE="1"
#! SOURCE_PORT_DESC="fo 0"
#! TARGET_PORT_DESC="fi 0"
#! ENABLED="true"
#! EXTRA_POINTS=""
#! />
#! <FEAT_LINK
#! IDENTIFIER="14"
#! SOURCE_NODE="1"
#! TARGET_NODE="4"
#! SOURCE_PORT_DESC="fo 0"
#! TARGET_PORT_DESC="0"
#! ENABLED="true"
#! EXTRA_POINTS=""
#! />
#! <FEAT_LINK
#! IDENTIFIER="9"
#! SOURCE_NODE="10"
#! TARGET_NODE="8"
#! SOURCE_PORT_DESC="0"
#! TARGET_PORT_DESC="fi 0"
#! ENABLED="true"
#! EXTRA_POINTS=""
#! />
#! <FEAT_LINK
#! IDENTIFIER="11"
#! SOURCE_NODE="8"
#! TARGET_NODE="7"
#! SOURCE_PORT_DESC="fo 0"
#! TARGET_PORT_DESC="fi 0"
#! ENABLED="true"
#! EXTRA_POINTS=""
#! />
#! </FEAT_LINKS>
#! <BREAKPOINTS>
#! </BREAKPOINTS>
#! <ATTR_LINKS>
#! </ATTR_LINKS>
#! <SUBDOCUMENTS>
#! </SUBDOCUMENTS>
#! <LOOKUP_TABLES>
#! </LOOKUP_TABLES>
#! </TRANSFORMER>
#! 
DEFAULT_MACRO $(AGO_WebMap_WORKSPACE_NAME)_ArcGisToken 
DEFAULT_MACRO $(AGO_WebMap_WORKSPACE_NAME)_referer https://www.arcgis.com
DEFAULT_MACRO $(AGO_WebMap_WORKSPACE_NAME)_WebmapID 
#! START_HEADER
#! END_HEADER

LOG_FILTER_MASK -1
DEFAULT_MACRO WB_CURRENT_CONTEXT
DEFAULT_MACRO AGO_WebMap_WORKSPACE_NAME ""
INCLUDE [puts {MACRO WB_OLD_CONTEXT_$(AGO_WebMap_WORKSPACE_NAME) $(WB_CURRENT_CONTEXT)};          puts {MACRO WB_CURRENT_CONTEXT $(AGO_WebMap_WORKSPACE_NAME)}]
FACTORY_DEF * TeeFactory   FACTORY_NAME "$(AGO_WebMap_WORKSPACE_NAME)_Input1405958202 Input Splitter"   INPUT FEATURE_TYPE "$(AGO_WebMap_WORKSPACE_NAME)_Input"   OUTPUT FEATURE_TYPE "$(AGO_WebMap_WORKSPACE_NAME)_Input"
# -------------------------------------------------------------------------

Tcl2 proc $(AGO_WebMap_WORKSPACE_NAME)_ParameterFetcher_doFetch {} {    foreach {name val} {"ArcGis_token {$($(AGO_WebMap_WORKSPACE_NAME)_ArcGisToken$encode)} _referer {$($(AGO_WebMap_WORKSPACE_NAME)_referer$encode)} _WebmapID {$($(AGO_WebMap_WORKSPACE_NAME)_WebmapID$encode)}"} {         if { [string match {*<at>*} $val] == 1 } {             set val [FME_Execute EvaluateExpression {STRING} $val {$(AGO_WebMap_WORKSPACE_NAME)_ParameterFetcher}];         } elseif {[string match {*FME_CONDITIONAL*} $val] == 1} {             set val [FME_Execute EvaluateExpression {STRING} $val {$(AGO_WebMap_WORKSPACE_NAME)_ParameterFetcher}];         } else {             set val [FME_DecodeTextOrAttr $val];         };       FME_SetAttribute [FME_DecodeText $name] $val    } }
FACTORY_DEF * TeeFactory    FACTORY_NAME $(AGO_WebMap_WORKSPACE_NAME)_ParameterFetcher    INPUT  FEATURE_TYPE "$(AGO_WebMap_WORKSPACE_NAME)_Input"    OUTPUT FEATURE_TYPE "$(AGO_WebMap_WORKSPACE_NAME)_ParameterFetcher_OUTPUT"         @Tcl2($(AGO_WebMap_WORKSPACE_NAME)_ParameterFetcher_doFetch)

# -------------------------------------------------------------------------
FACTORY_DEF * AttrSetFactory FACTORY_NAME $(AGO_WebMap_WORKSPACE_NAME)_AttributeCreator_2 INPUT  FEATURE_TYPE "$(AGO_WebMap_WORKSPACE_NAME)_ParameterFetcher_OUTPUT" ATTR urlGetWebMap <at>Value<openparen>_referer<closeparen><solidus>sharing<solidus>rest<solidus>content<solidus>items<solidus><at>Value<openparen>_WebmapID<closeparen><solidus>data    OUTPUT OUTPUT FEATURE_TYPE "$(AGO_WebMap_WORKSPACE_NAME)_AttributeCreator_2_OUTPUT" 
# -------------------------------------------------------------------------

FACTORY_DEF * HTTPFactory    FACTORY_NAME $(AGO_WebMap_WORKSPACE_NAME)_HTTPUploader       INPUT  FEATURE_TYPE "$(AGO_WebMap_WORKSPACE_NAME)_AttributeCreator_2_OUTPUT"    TARGET_URL "@EvaluateExpression(STRING_ENCODED,<at>Value<openparen>urlGetWebMap<closeparen>,$(AGO_WebMap_WORKSPACE_NAME)_HTTPUploader)"    TARGET_ATTR webMapJson    HTTP_METHOD POST    UPLOAD_BODY "@EvaluateExpression(STRING_ENCODED,f=json<amp>token=<at>Value<openparen>ArcGis_token<closeparen>,$(AGO_WebMap_WORKSPACE_NAME)_HTTPUploader)"    UPLOAD_CONTENT_TYPE "application/x-www-form-urlencoded"    AUTH_USERNAME ""    AUTH_PASSWORD ""    AUTH_METHOD Basic    SINGLE_SIGN_ON No    PROXY_AUTH_METHOD Basic    TARGET_ATTRIBUTE_ENCODING    RESPONSE_HEADER_LIST_ATTR "_headers"    STATUS_CODE_ATTR "_http_status_code"    ERROR_ATTR "_error"    FOLLOW_REDIRECTS Yes    VERIFY_SSL_CERTIFICATES Yes    USE_COOKIES No    OUTPUT OUTPUT FEATURE_TYPE "$(AGO_WebMap_WORKSPACE_NAME)_HTTPUploader_OUTPUT"    OUTPUT REJECTED FEATURE_TYPE "$(AGO_WebMap_WORKSPACE_NAME)_HTTPUploader_<REJECTED>"


FACTORY_DEF * TeeFactory   FACTORY_NAME "$(AGO_WebMap_WORKSPACE_NAME)_HTTPUploader <REJECTED> Output Nuker"   INPUT FEATURE_TYPE "$(AGO_WebMap_WORKSPACE_NAME)_HTTPUploader_<REJECTED>"
FACTORY_DEF * TeeFactory   FACTORY_NAME "$(AGO_WebMap_WORKSPACE_NAME)_WebMap1405958202 Output Collector"   INPUT FEATURE_TYPE "$(AGO_WebMap_WORKSPACE_NAME)_HTTPUploader_OUTPUT"   OUTPUT FEATURE_TYPE "$(AGO_WebMap_WORKSPACE_NAME)_WebMap" @RemoveAttributes(_referer,_WebmapID,urlGetWebMap,_error,_http_status_code) @RemoveAttributes(fme_regexp_match,_headers{}.name,_headers{}.value)
INCLUDE [puts {MACRO WB_CURRENT_CONTEXT $(WB_OLD_CONTEXT_$(AGO_WebMap_WORKSPACE_NAME))}]
